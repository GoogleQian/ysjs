webpackJsonp([28],{W7xt:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),i=a.n(r),n=a("VjnB"),l=a("axK0"),s=a("0N3M");var o=[{label:"设备编码",value:"devNo",type:"input",placeholder:"设备编码"}],d=[],c=[{label:"设备编号",width:120,value:"device_id"},{label:"最新水质状况",value:"waterStatus",formatter:function(e){var t=e.waterStatus||{},a=t.out_tds;return void 0===a?"":a<=50?'<span style="color: #67C23A;">优</span>':a<=100&&a>50?'<span style="color: #409EFF;">良</span>':a<=300&&a>100?'<span style="color: #E6A23C;">中</span>':a>100?'<span style="color: #F56C6C;">差</span>':t.out_tds}},{label:"在线状态",value:"isOnline",formatter:function(e){switch(e.isOnline){case 0:return'<span style="color: #F56C6C;">离线</span>';case 1:return'<span style="color: #67C23A;">在线</span>'}}},{label:"设备最新状态",mul:!0,subColumns:[{label:"水位",width:50,formatter:function(e){var t=e.waterStatus||{},a="";return 0===t.water_level_status?a="无":1===t.water_level_status?a="低":2===t.water_level_status?a="中":3===t.water_level_status&&(a="高"),a}},{label:"信号强度",width:80,formatter:function(e){var t=e.waterStatus||{},a="";return 0===t.model_strength?a="极低":1===t.model_strength?a="低":2===t.model_strength?a="中":3===t.model_strength&&(a="高"),a}},{label:"故障代码",width:80,formatter:function(e){var t=e.waterStatus||{};return t.error_code?t.error_code.toString(16):""}},{label:"换水状态",width:70,formatter:function(e){var t=e.change_water_status||{};return 0===t?"-":1===t?"正在换水":"-"}},{label:"冲洗状态",width:70,formatter:function(e){var t=e.rinse_status||{};return 0===t?"-":1===t?"正在冲洗":"-"}},{label:"消毒状态",width:70,formatter:function(e){var t=e.disinfection_status||{};return 0===t?"-":1===t?"正在消毒":"-"}},{label:"加热状态",width:70,formatter:function(e){var t=e.heating_status||{};return 0===t?"-":1===t?"正在加热":"-"}},{label:"进水状态",width:70,formatter:function(e){var t=e.in_water_status||{};return 0===t?"关进水":1===t?"进水":"-"}},{label:"出水状态",width:150,formatter:function(e){var t=e.pass_one||{},a=e.pass_two||{},r=e.pass_third||{},i=e.pass_four||{};return"通道1："+(0===t?"关":1===t?"开":"-")+"&nbsp; 通道2："+(0===a?"关":1===a?"开":"-")+"<br />通道3："+(0===r?"关":1===r?"开":"-")+"&nbsp; 通道4："+(0===i?"关":1===i?"开":"-")}},{label:"显示温度(上报时间)",width:170,formatter:function(e){return e.shakeHandTime?e.show_temp+" ("+e.shakeHandTime+")":e.show_temp}}]},{label:"换芯提醒阀值",value:"filter_fazhi",formatter:function(){return"40"}},{label:"是否到期更换滤芯",value:"need_reinstall",formatter:function(){return"否"}},{label:"备注",width:100,value:"remark"},{label:"更新时间",value:"update_time"}],u={data:function(){return{tableData:[],page:{total:0,currentPage:1},funcs:d,tableColumns:c,searchItems:o,tableLoading:!1,btnLoading:!1,searchForm:{},dialogTitle:"新增",dialogVisible:!1,labelWidth:"100px",dialogData:{schemalist:[]},allDev:[],allRepair:[]}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.tableLoading=!0;var t,a=i()({page:this.page.currentPage},this.searchForm,{id:Number(localStorage.getItem("userId")),faultFlag:1});(t=a,Object(s.a)({url:"/repairers/devFaults",method:"post",data:t})).then(function(t){e.tableLoading=!1,e.tableData=t.data.datas.list,e.page.total=t.data.datas.itemCounts})},search:function(e){console.log(e),e.maintenanceTime&&(e.startTime=e.maintenanceTime[0],e.endTime=e.maintenanceTime[1],delete e.maintenanceTime),this.page.currentPage=1,this.searchForm=i()({},e),this.getList()},func:function(e){var t=e.opera,a=e.row;switch(t){case"修改":this.edit(a);break;case"新增":this.add();break;case"删除":this.del(a)}},add:function(){this.dialogTitle="新增",this.dialogData={},this.dialogVisible=!0},edit:function(e){this.dialogTitle="编辑",this.dialogData=i()({},e),this.dialogVisible=!0},del:function(e){var t=this;this.$confirm("此操作将永久删除所选数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a,r;(a={id:e.id},r=a.id,Object(s.a)({url:"/repairRecord/"+r,method:"delete"})).then(function(e){console.log("shanchu "),t.$message({message:0===e.data.ret?"删除成功":e.data.msg,type:0===e.data.ret?"success":"error"}),t.getList()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},handleCurrentChange:function(e){this.page.currentPage=e,this.getList()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a,r,n,l=t.dialogData;"编辑"===t.dialogTitle?(a={id:t.dialogData.id,data:i()({},t.dialogData)},r=a.id,n=a.data,Object(s.a)({url:"/repairRecord/"+r,method:"put",data:n})).then(function(e){0==e.data.ret?(t.$message({message:"修改成功",type:"success"}),t.dialogVisible=!1,t.getList()):t.$message({message:e.data.msg,type:"error"})}):"新增"===t.dialogTitle&&function(e){return Object(s.a)({url:"/repairRecord/",method:"post",data:e})}(l).then(function(e){0==e.data.ret?(t.$message({message:"新增成功",type:"success"}),t.dialogVisible=!1,t.getList()):t.$message({message:e.data.msg,type:"error"})})})}},computed:{isRepairer:function(){return localStorage.getItem("isRepairer")}},components:{ZTable:n.a,ZSearch:l.a}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"box"},[a("z-search",{attrs:{searchItems:e.searchItems},on:{search:e.search}}),e._v(" "),a("z-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{tableData:e.tableData,tableColumns:e.tableColumns,page:e.page,funcs:e.funcs},on:{func:e.func,handleCurrentChange:e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.dialogData,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"设备编码:",prop:"devCode"}},[a("el-input",{model:{value:e.dialogData.devCode,callback:function(t){e.$set(e.dialogData,"devCode",t)},expression:"dialogData.devCode"}})],1),e._v(" "),e.isRepairer?e._e():a("el-form-item",{attrs:{label:"维修人员:",prop:"repairerId"}},[a("el-select",{model:{value:e.dialogData.repairerId,callback:function(t){e.$set(e.dialogData,"repairerId",t)},expression:"dialogData.repairerId"}},e._l(e.allRepair,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.realName}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"维修时间:",prop:"maintenanceTime"}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.dialogData.maintenanceTime,callback:function(t){e.$set(e.dialogData,"maintenanceTime",t)},expression:"dialogData.maintenanceTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"维修详情:",prop:"content"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.dialogData.content,callback:function(t){e.$set(e.dialogData,"content",t)},expression:"dialogData.content"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(u,m,!1,function(e){a("cAlS")},"data-v-a7832c74",null);t.default=g.exports},cAlS:function(e,t){}});