webpackJsonp([19],{"5Ibv":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("Dd8w"),r=a.n(n),s=a("VjnB"),i=a("axK0"),o=a("oNXm"),c=a("PJh5"),l=a.n(c),u=[{label:"方案名",value:"pro_name",type:"input",placeholder:"方案名"}],d=[{label:"方案名",value:"pro_name"},{label:"创建时间",value:"create_time",width:200,formatter:function(t){return t.create_time?l()(t.create_time).format("YYYY-MM-DD HH:mm:ss"):"-"}}],m={data:function(){return{tableData:[],page:{total:0,currentPage:1},tableColumns:d,searchItems:u,tableLoading:!1,searchForm:{},dialogTitle:"新增",dialogVisible:!1,labelWidth:"100px",dialogData:{schemalist:[]}}},created:function(){this.getList()},methods:{getList:function(){var t=this;this.tableLoading=!0;var e=r()({page:this.page.currentPage},this.searchForm);Object(o.d)(e).then(function(e){t.tableLoading=!1,t.tableData=e.data.datas.list,t.page.total=e.data.datas.itemCounts})},search:function(t){this.page.currentPage=1,this.searchForm=t,this.getList()},func:function(t){var e=t.opera,a=t.row;switch(e){case"修改":this.edit(a);break;case"新增":this.add();break;case"删除":this.del(a)}},add:function(){this.dialogTitle="新增",this.dialogData={schemalist:[{}]},this.dialogVisible=!0},edit:function(t){this.dialogTitle="编辑",this.dialogData=r()({},t),this.dialogVisible=!0,this.dialogData.schemalist&&0!==this.dialogData.schemalist.length||(this.dialogData.schemalist=[{}])},del:function(t){var e=this;console.log(t),this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.b)({id:t.id}).then(function(t){e.$message({message:0===t.data.ret?"删除成功":t.data.msg,type:0===t.data.ret?"success":"error"}),e.getList()})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},handleCurrentChange:function(t){this.page.currentPage=t,this.getList()},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var a=e.dialogData;a.water_amount=a.schemalist.map(function(t){return t.water_amount}).join(","),"编辑"===e.dialogTitle?Object(o.c)(a).then(function(t){0==t.data.ret?(e.$message({message:"修改成功",type:"success"}),e.dialogVisible=!1,e.getList()):e.$message({message:t.data.msg,type:"error"})}):"新增"===e.dialogTitle&&Object(o.a)(a).then(function(t){0==t.data.ret?(e.$message({message:"新增成功",type:"success"}),e.dialogVisible=!1,e.getList()):e.$message({message:t.data.msg,type:"error"})})})},addItem:function(t){this.dialogData.schemalist.splice(t+1,0,{})},delItem:function(t){this.dialogData.schemalist.splice(t,1)}},computed:{funcs:function(){return this.$store.state.user.funcs}},components:{ZTable:s.a,ZSearch:i.a}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sale-plan top-border"},[a("z-search",{attrs:{searchItems:t.searchItems},on:{search:t.search}}),t._v(" "),a("z-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{tableData:t.tableData,tableColumns:t.tableColumns,page:t.page,funcs:t.funcs},on:{func:t.func,handleCurrentChange:t.handleCurrentChange}}),t._v(" "),a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.dialogData,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"方案名",prop:"pro_name"}},[a("el-input",{model:{value:t.dialogData.pro_name,callback:function(e){t.$set(t.dialogData,"pro_name",e)},expression:"dialogData.pro_name"}})],1),t._v(" "),t._l(t.dialogData.schemalist,function(e,n){return a("el-row",{key:e.id},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"水量名",prop:"name"}},[a("el-input",{model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"item.name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"水量",prop:"water_amount"}},[a("el-input",{staticStyle:{width:"70%"},model:{value:e.water_amount,callback:function(a){t.$set(e,"water_amount",t._n(a))},expression:"item.water_amount"}}),t._v(" ML\n                    ")],1)],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{on:{click:function(e){t.addItem(n)}}},[t._v("+")])],1),t._v(" "),0!==n?a("el-col",{attrs:{span:2}},[a("el-button",{on:{click:function(e){t.delItem(n)}}},[t._v("-")])],1):t._e()],1)}),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("保存")])],1)],2)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(m,h,!1,function(t){a("rI5R")},"data-v-3562fd16",null);e.default=p.exports},oNXm:function(t,e,a){"use strict";a.d(e,"d",function(){return b}),a.d(e,"a",function(){return v}),a.d(e,"c",function(){return _}),a.d(e,"b",function(){return w});var n,r,s,i,o,c,l=a("Dd8w"),u=a.n(l),d=a("Xxa5"),m=a.n(d),h=a("exGp"),p=a.n(h),f=a("0N3M"),g=a("mw3O"),b=(n=p()(m.a.mark(function t(e){var a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({url:"/schema/",method:"get",params:e});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)}),v=(r=p()(m.a.mark(function t(e){var a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({url:"/schema/",method:"post",data:u()({},e)});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)}),_=(s=p()(m.a.mark(function t(e){var a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({url:"/schema/"+e.id,method:"put",data:u()({},e)});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)}),w=(i=p()(m.a.mark(function t(e){var a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({url:"/schema/"+e.id,method:"delete"});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)});o=p()(m.a.mark(function t(e){var a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({url:"/agent/get_agent_list",method:"post",data:g.stringify(u()({},e))});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,this)})),c=p()(m.a.mark(function t(e){var a;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({url:"/device/assignment_dev",method:"post",data:g.stringify(u()({},e))});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,this)}))},rI5R:function(t,e){}});