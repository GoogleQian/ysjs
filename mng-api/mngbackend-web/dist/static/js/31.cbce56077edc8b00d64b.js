webpackJsonp([31],{"0Aj2":function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=t("Dd8w"),l=t.n(i),s=t("VjnB"),o=t("axK0"),n=t("0N3M");t("mw3O");var r=[{label:"设备编号",value:"dev_no",type:"input",placeholder:"设备编号"}],d=[{label:"设备编号",value:"dev_no"},{label:"数量",value:"num"},{label:"价格",value:"price"},{label:"开始时间",value:"start_time"},{label:"结束时间",value:"end_time"}],c={data:function(){return{tableData:[],page:{total:0,currentPage:1},tableColumns:d,searchItems:r,tableLoading:!1,searchForm:{},dialogTitle:"新增",dialogVisible:!1,labelWidth:"100px",dialogData:{schemalist:[]},allDev:[]}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.tableLoading=!0,function(e){return Object(n.a)({url:"/sale/coupons",method:"get",params:e})}(l()({page:this.page.currentPage},this.searchForm)).then(function(a){e.tableLoading=!1,e.tableData=a.data.datas.list,e.page.total=a.data.datas.itemCounts})},getAllDev:function(e){var a=this;(function(e){return Object(n.a)({url:"sale/coupons/devIds",method:"get",params:e})})(e).then(function(e){null!==e.data.datas&&0!==e.data.datas.length?a.allDev=e.data.datas:a.$message({message:"无可选设备",type:"warning"})})},search:function(e){this.page.currentPage=1,this.searchForm=e,this.getList()},func:function(e){var a=e.opera,t=e.row;switch(a){case"修改":this.edit(t);break;case"新增":this.add();break;case"删除":this.del(t)}},add:function(){this.dialogTitle="新增",this.dialogData={},this.dialogVisible=!0,this.getAllDev()},edit:function(e){this.dialogTitle="编辑",this.dialogData=l()({},e),this.dialogVisible=!0,this.getAllDev({device_id:e.dev_no,id:e.dev_id})},del:function(e){var a=this;this.$confirm("此操作将永久删除该条数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t,i;(t={couponId:e.id},i=t.couponId,Object(n.a)({url:"/sale/coupons/"+i,method:"delete"})).then(function(e){a.$message({message:0===e.data.ret?"删除成功":e.data.msg,type:0===e.data.ret?"success":"error"}),a.getList()})}).catch(function(){a.$message({type:"info",message:"已取消删除"})})},handleCurrentChange:function(e){this.page.currentPage=e,this.getList()},submitForm:function(e){var a=this;this.$refs[e].validate(function(e){if(!e)return!1;var t,i,s,o=a.dialogData;"编辑"===a.dialogTitle?(t={couponId:a.dialogData.id,data:l()({},a.dialogData)},i=t.couponId,s=t.data,Object(n.a)({url:"/sale/coupons/"+i,method:"put",data:s})).then(function(e){0==e.data.ret?(a.$message({message:"修改成功",type:"success"}),a.dialogVisible=!1,a.getList()):a.$message({message:e.data.msg,type:"error"})}):"新增"===a.dialogTitle&&function(e){return Object(n.a)({url:"/sale/coupons",method:"post",data:e})}(o).then(function(e){0==e.data.ret?(a.$message({message:"新增成功",type:"success"}),a.dialogVisible=!1,a.getList()):a.$message({message:e.data.msg,type:"error"})})})},addItem:function(e){this.dialogData.schemalist.splice(e+1,0,{})},delItem:function(e){this.dialogData.schemalist.splice(e,1)}},computed:{funcs:function(){return this.$store.state.user.funcs}},components:{ZTable:s.a,ZSearch:o.a}},u={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"sale-plan top-border"},[t("z-search",{attrs:{searchItems:e.searchItems},on:{search:e.search}}),e._v(" "),t("z-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{tableData:e.tableData,tableColumns:e.tableColumns,page:e.page,funcs:e.funcs},on:{func:e.func,handleCurrentChange:e.handleCurrentChange}}),e._v(" "),t("el-dialog",{attrs:{title:"优惠券"+e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(a){e.dialogVisible=a}}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.dialogData,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"单张面额"}},[t("el-input",{model:{value:e.dialogData.str_price,callback:function(a){e.$set(e.dialogData,"str_price",e._n(a))},expression:"dialogData.str_price"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"数量"}},[t("el-input",{model:{value:e.dialogData.num,callback:function(a){e.$set(e.dialogData,"num",e._n(a))},expression:"dialogData.num"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"开始时间"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.dialogData.start_time,callback:function(a){e.$set(e.dialogData,"start_time",a)},expression:"dialogData.start_time"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"结束时间"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.dialogData.end_time,callback:function(a){e.$set(e.dialogData,"end_time",a)},expression:"dialogData.end_time"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"设备"}},[t("el-select",{attrs:{placeholder:"请选择设备",clearable:""},model:{value:e.dialogData.dev_id,callback:function(a){e.$set(e.dialogData,"dev_id",a)},expression:"dialogData.dev_id"}},e._l(e.allDev,function(e){return t("el-option",{key:e.id,attrs:{label:e.device_id,value:e.id}})}))],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var g=t("VU/8")(c,u,!1,function(e){t("aD7Q")},"data-v-7cf83d45",null);a.default=g.exports},aD7Q:function(e,a){}});