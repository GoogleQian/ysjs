webpackJsonp([26],{"3W9p":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n,a,i,o,l,u,d=s("Dd8w"),c=s.n(d),p=s("L6bb"),m=s.n(p),f=s("Xxa5"),v=s.n(f),h=s("exGp"),_=s.n(h),b=s("0N3M"),g=s("mw3O"),w=(r=_()(v.a.mark(function e(t){var s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)({url:"/user/list",method:"post",data:g.stringify(c()({},t))});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),k=(n=_()(v.a.mark(function e(t){var s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)({url:"/user/update_permi",method:"post",data:g.stringify(c()({},t))});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)}),x=(a=_()(v.a.mark(function e(t){var s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)({url:"/user/add",method:"post",data:g.stringify(c()({},t))});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)}),y=(i=_()(v.a.mark(function e(t){var s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)({url:"/user/update",method:"post",data:g.stringify(c()({},t))});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)}),F=(o=_()(v.a.mark(function e(t){var s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)({url:"/user/delete",method:"post",data:g.stringify(c()({},t))});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),$=(l=_()(v.a.mark(function e(t){var s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)({url:"/user/update_remark",method:"post",data:g.stringify(c()({},t))});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)}),E=(u=_()(v.a.mark(function e(t){var s;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)({url:"/user/update_psd",method:"post",data:g.stringify(c()({},t))});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)}),C={name:"useradmin",data:function(){var e=this;return{selectId:null,userLoading:!1,getDataing:!1,deleteRow:!1,tableData:[],id:null,psd:{id:null,psd:null,psd_confirm:null},psd_update:{show:!1,rules:{psd:[{required:!0,message:"请输入密码",trigger:"blur"}],psd_confirm:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:function(t,s,r){""===s?r(new Error("请再次输入密码")):s!==e.psd.psd?(console.log(e.psd.psd),r(new Error("两次输入密码不一致!"))):r()},trigger:"blur"}]}},userInfo:{id:null,username:null,remark:null,auths:[]},addForm:{show:!1,title:"新增",btnText:"保存"},form:{username:"",remark:"",psd:"",psd_confirm:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:15,message:"长度在 3 到 15 个字符",trigger:"blur"}],psd_confirm:[{validator:function(t,s,r){""===s?r(new Error("请再次输入密码")):s!==e.form.psd?(console.log(e.form.psd),r(new Error("两次输入密码不一致!"))):r()},trigger:"blur"}]}}},created:function(){this.getUserList()},methods:{getUserList:function(){var e=this;this.selectId=null,this.getDataing=!0,w({page_size:1e3}).then(function(t){e.getDataing=!1;var s=t.data.datas,r=sessionStorage.getItem("user_id");(s=s.filter(function(e){return e.user_id!=r})).map(function(e){e.isEdit=!1}),e.tableData=s})},update_permi:function(){var e=this,t={id:this.selectId,menus:this.userInfo.menus.join(",")};k(t).then(function(t){0==t.data.ret&&(e.$message({type:"success",message:"修改成功"}),e.getUserList())})},userAdd:function(){var e=this,t=c()({},this.form);t.psd=m()(t.psd),t.psd_confirm=m()(t.psd_confirm),x(t).then(function(t){0==t.data.ret&&(e.addForm.show=!1,e.$message({message:"新增完成",type:"success"}),e.getUserList())})},userEdit:function(){var e=this,t=c()({},this.form,{id:this.id});t.psd=m()(t.psd),t.psd_confirm=m()(t.psd_confirm),y(t).then(function(t){0==t.data.ret&&(e.$message({message:"修改完成",type:"success"}),e.addForm.show=!1,e.getUserList())})},userdelete:function(){var e=this,t={id:this.id};this.deleteRow=!1,F(t).then(function(t){0==t.data.ret&&(e.$message({message:"删除完成",type:"success"}),e.getUserList())})},handleCurrentChange:function(e,t){t&&(this.selectId=t.id||"",this.userInfo=c()({},t))},handleAdd:function(){this.addForm.show=!0,this.addForm.title="新增",this.form=c()({},this.backupForm)},handleDelete:function(e,t){this.deleteRow=!0,this.id=t.id},handleEdit:function(e,t){this.form={username:t.username,remark:t.remark},this.id=t.id,this.addForm.show=!0,this.addForm.title="编辑"},submitForm1:function(e){var t=this;this.$refs[e].validate(function(e){if(e){console.log("valid");var s=c()({},t.psd);s.psd=m()(s.psd),s.psd_confirm=m()(s.psd_confirm),E(s).then(function(e){0==e.data.ret&&(t.$message({message:"修改成功",type:"success"}),t.psd.show=!1)})}else console.log("invalid")})},submitForm:function(e){var t=this;console.log(1),this.$refs[e].validate(function(e){if(!e)return console.log("参数错误"),!1;"新增"==t.addForm.title?t.userAdd():"编辑"==t.addForm.title&&t.userEdit()})},edit:function(e,t){t.isEdit=!0,t._remark=t.remark},save:function(e,t){var s=this;t.isEdit=!1;var r={id:t.id,remark:t._remark};$(r).then(function(e){0==e.data.ret&&(s.$message({message:"修改成功",type:"success"}),t.remark=t._remark,s.getUserList())})},cancel:function(e,t){t.isEdit=!1},handlePsdUpdate:function(e,t){this.psd_update.show=!0,this.psd.id=t.id}},computed:{backupForm:function(){return c()({},this.form)}}},D={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.getDataing,expression:"getDataing"}],staticClass:"useradmin"},[s("el-button",{on:{click:e.handleAdd}},[e._v("新增")]),e._v(" "),s("el-table",{staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:e.tableData,"highlight-current-row":"",height:"491",border:""}},[s("el-table-column",{attrs:{label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-time"}),e._v(" "),s("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.username))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"备注",width:"800"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.row.isEdit,expression:"!scope.row.isEdit"}]},[s("div",{staticClass:"remarksText"},[e._v(e._s(t.row.remark))]),e._v(" "),s("el-button",{staticStyle:{float:"right"},attrs:{size:"mini",type:"text"},on:{click:function(s){e.edit(t.$index,t.row)}}},[s("i",{staticClass:"el-icon-edit"})])],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.row.isEdit,expression:"scope.row.isEdit"}]},[s("el-input",{staticClass:"remarksEdit",staticStyle:{width:"200px"},attrs:{placeholder:"请输入内容",size:"mini"},model:{value:t.row._remark,callback:function(s){e.$set(t.row,"_remark",s)},expression:"scope.row._remark"}}),e._v(" "),s("el-button",{attrs:{type:"warning",plain:"",size:"mini"},on:{click:function(s){e.cancel(t.$index,t.row)}}},[s("i",{staticClass:"el-icon-back"}),e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"success",plain:"",size:"mini"},on:{click:function(s){e.save(t.$index,t.row)}}},[s("i",{staticClass:"el-icon-success"}),e._v("保存")])],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini"},on:{click:function(s){e.handleCurrentChange(t.$index,t.row)}}},[e._v("权限设置")]),e._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(s){s.stopPropagation(),s.preventDefault(),e.handlePsdUpdate(t.$index,t.row)}}},[e._v("修改密码")]),e._v(" "),s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(s){s.stopPropagation(),s.preventDefault(),e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),e.selectId?s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],staticClass:"userinfo"},[s("div",{staticStyle:{"margin-top":"20px"}},[s("p",[e._v("用户权限设置\n        "),s("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.userInfo.username))])],1),e._v(" "),s("el-checkbox-group",{staticStyle:{float:"left"},attrs:{size:"mini"},model:{value:e.userInfo.menus,callback:function(t){e.$set(e.userInfo,"menus",t)},expression:"userInfo.menus"}},[s("el-checkbox",{attrs:{label:"devMap",border:""}},[e._v("设备分布")]),e._v(" "),s("el-checkbox",{attrs:{label:"dev",border:""}},[e._v("设备管理")]),e._v(" "),s("el-checkbox",{attrs:{label:"history",border:""}},[e._v("水质数据")]),e._v(" "),s("el-checkbox",{attrs:{label:"filter",border:""}},[e._v("滤芯更换")]),e._v(" "),s("el-checkbox",{attrs:{label:"user",border:""}},[e._v("用户管理")])],1),e._v(" "),s("el-button",{staticStyle:{float:"right"},on:{click:e.update_permi}},[e._v("保存")])],1)]):e._e(),e._v(" "),s("el-dialog",{attrs:{title:e.addForm.title,visible:e.addForm.show},on:{"update:visible":function(t){e.$set(e.addForm,"show",t)}}},[s("el-form",{ref:"addForm",staticClass:"demo-ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"用户名",prop:"username"}},[s("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),s("el-form-item",{attrs:{type:"password",label:"密码",prop:"psd"}},[s("el-input",{model:{value:e.form.psd,callback:function(t){e.$set(e.form,"psd",t)},expression:"form.psd"}})],1),e._v(" "),s("el-form-item",{attrs:{type:"password",label:"确认密码",prop:"psd_confirm"}},[s("el-input",{model:{value:e.form.psd_confirm,callback:function(t){e.$set(e.form,"psd_confirm",t)},expression:"form.psd_confirm"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"备注",prop:"remark"}},[s("el-input",{model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e._v(" "),s("el-form-item",[s("el-button",{on:{click:function(t){e.submitForm("addForm")}}},[e._v(e._s(e.addForm.btnText))])],1)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"提示",visible:e.deleteRow,width:"30%"},on:{"update:visible":function(t){e.deleteRow=t}}},[s("span",[e._v("这是一段信息")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.deleteRow=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{on:{click:e.userdelete}},[e._v("确 定")])],1)]),e._v(" "),s("el-dialog",{attrs:{title:"修改密码",visible:e.psd_update.show},on:{"update:visible":function(t){e.$set(e.psd_update,"show",t)}}},[s("el-form",{ref:"psd",staticClass:"demo-ruleForm",attrs:{model:e.psd,rules:e.psd_update.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"密码",prop:"psd"}},[s("el-input",{model:{value:e.psd.psd,callback:function(t){e.$set(e.psd,"psd",t)},expression:"psd.psd"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"确认密码",prop:"psd_confirm"}},[s("el-input",{model:{value:e.psd.psd_confirm,callback:function(t){e.$set(e.psd,"psd_confirm",t)},expression:"psd.psd_confirm"}})],1),e._v(" "),s("el-form-item",[s("el-button",{on:{click:function(t){e.submitForm1("psd")}}},[e._v(e._s(e.addForm.btnText))])],1)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"提示",visible:e.deleteRow,width:"30%"},on:{"update:visible":function(t){e.deleteRow=t}}},[s("span",[e._v("这是一段信息")]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.deleteRow=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{on:{click:e.userdelete}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var I=s("VU/8")(C,D,!1,function(e){s("WyhG")},"data-v-c2e00ab0",null);t.default=I.exports},WyhG:function(e,t){}});